{% extends 'base2.html' %}

{% block title %} Admin Dashboard {% endblock %}

{% load static bootstrap5 %}
{% bootstrap_css %}
{% bootstrap_javascript %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
<style>
    .pagination {
        display: flex;
        justify-content: center;
        margin-top: 20px;
    }

    .pagination .btn {
        margin: 0 5px;
        background-color: chocolate;
        color: white;
    }

    .pagination .btn-primary {
        background-color: darkorange;
        color: white;
    }
</style>
{% endblock %}

{% block content %}
<div class="wrapper d-flex">

    <!-- Sidebar -->
    <aside class="sidebar p-3 shadow-sm">
        <h4 class="welcome mb-4">Welcome, {{ user.get_short_name }}</h4>

        <nav class="menu d-flex flex-column gap-2">
            <a href="{% url 'admin_dashboard:dashboard' %}" class="text-white text-decoration-none">Dashboard</a>
            <a href="{% url 'admin_dashboard:manage_users' %}" class="text-white text-decoration-none">Manage
                Users</a>
            <a href="{%url 'admin_dashboard:manage_workshops'%}" class="text-white text-decoration-none" >Manage Workshops</a>
            <a href="{% url 'admin_dashboard:manage_services' %}" class="active-link text-white text-decoration-none">Manage Services</a>
        </nav>
    </aside>

    <main class="main-content flex-grow-1 p-4">
        <div class="d-flex justify-content-between">
            <h1 class="mb-4">Manage Services</h1>
            <div>
                <a class="btn btn-warning text-white" style="background-color: #ff6600;" 
               href="{% url 'admin_dashboard:create_service' %}">Add New Service</a>
            </div>
        </div>

        <div class="search-box mb-3">
            <input type="text" class="form-control" placeholder="Search...">
        </div>

        <table class="table table-striped">
            <thead>
                <tr class="main">
                    <th>Workshop</th>
                    <th>Name</th>
                    <th>Price</th>
                    <th>Description</th>
                    <th>Duration (min)</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for service in services %}
                <tr id="service-{{ service.id }}">
                    <td>{{ service.workshop.name }}</td>
                    <td contenteditable="true" class="editable" data-id="{{ service.id }}" data-field="name">{{ service.name }}</td>
                    <td contenteditable="true" class="editable" data-id="{{ service.id }}" data-field="price">{{ service.price }}</td>
                    <td contenteditable="true" class="editable" data-id="{{ service.id }}" data-field="description">{{ service.description }}</td>
                    <td contenteditable="true" class="editable" data-id="{{ service.id }}" data-field="duration">{{ service.duration }}</td>
                    <td>
                        <button class="btn btn-warning btn-sm" 
                        style="background-color: #ff6600; color:white;" 
                        data-id="{{ service.id }}"
                        onclick="window.location.href='{% url 'admin_dashboard:edit_service' service.id %}'">
                    Update
                </button>
                <button class="btn btn-dark btn-sm btn-delete" data-id="{{ service.id }}">Delete</button>

                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>      
        
    </main>

</div>
{% endblock %}


{% block extra_js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
$(document).ready(function() {
    $('.btn-delete').click(function () {
        const serviceId = $(this).data('id');

        if (confirm('Are you sure you want to delete this service?')) {
            $.ajax({
                url: '/admin_dashboard/admin/manage_services/delete/' + serviceId + '/',
                type: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                success: function (response) {
                    if (response.status === 'deleted') {
                        $('#service-' + serviceId).fadeOut(300, function () {
                            $(this).remove();
                        });
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Error deleting service:", error);
                    alert('An error occurred while deleting the service.');
                }
            });
        }
    });
});
</script>
{% endblock %}
